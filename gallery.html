<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Edition Visuals | StevenAiDigest</title>
  <meta name="description" content="Edition visuals for StevenAiDigest. Professional, source-backed memo format." />
  <link rel="alternate" type="application/rss+xml" title="StevenAiDigest" href="/feed.xml" />
  <link rel="stylesheet" href="/styles.css" />
  <style>
    .tools{display:flex; gap:10px; flex-wrap:wrap; margin:14px 0 18px}
    .search{flex:1; min-width:220px; padding:12px 12px; border-radius:12px; border:1px solid var(--line); background:rgba(255,255,255,0.03); color:var(--text); outline:none}
    .search:focus{border-color:rgba(124,92,255,0.6); box-shadow:0 0 0 4px rgba(124,92,255,0.15)}
    .select{padding:12px; border-radius:12px; border:1px solid var(--line); background:rgba(255,255,255,0.03); color:var(--text); outline:none}

    .grid{display:grid; grid-template-columns:repeat(auto-fill,minmax(280px,1fr)); gap:14px}
    .tile{display:block; text-decoration:none; background:rgba(255,255,255,0.03); border:1px solid var(--line); border-radius:18px; overflow:hidden; transition:transform 200ms ease, background 200ms ease, border-color 200ms ease}
    .tile:hover{transform:translateY(-4px); background:rgba(255,255,255,0.05); border-color:rgba(124,92,255,0.28)}
    .thumb{width:100%; height:190px; object-fit:cover; display:block; border-bottom:1px solid var(--line)}
    .info{padding:14px 14px 16px}
    .k{font-size:12px; font-weight:800; letter-spacing:0.12em; text-transform:uppercase; color:var(--muted)}
    .t{margin:6px 0 0; font-weight:900; font-size:16px}
    .s{margin:8px 0 0; color:var(--muted); line-height:1.6; font-size:13px}
    .tags{display:flex; flex-wrap:wrap; gap:6px; margin-top:12px}
    .tagpill{display:inline-flex; align-items:center; padding:6px 9px; border-radius:999px; border:1px solid var(--line); background:rgba(255,255,255,0.03); color:var(--muted); font-size:12px; text-decoration:none}

    @media (max-width:560px){
      .grid{grid-template-columns:1fr}
      .thumb{height:170px}
    }
  </style>
</head>
<body>
  <header class="site-header">
    <div class="wrap">
      <a class="brand" href="/">StevenAiDigest</a>
      <nav class="nav">
        <a href="/archive/">Archive</a>
        <a href="/tags/">Tags</a>
        <a href="/gallery.html" class="active">Gallery</a>
      </nav>
    </div>
  </header>

  <main class="wrap prose">
    <div class="kicker">Edition visuals</div>
    <h1>Gallery</h1>
    <p class="muted">A clean, public-facing view of edition thumbnails and visuals. No templates or internal tools.</p>

    <div class="tools" aria-label="Gallery tools">
      <input id="q" class="search" type="search" placeholder="Search (e.g. OpenAI, inference, AWS)" />
      <select id="y" class="select" aria-label="Year">
        <option value="all" selected>All years</option>
      </select>
    </div>

    <section class="grid" id="grid" aria-label="Edition visuals grid"></section>

    <noscript>
      <section class="card">
        <h2 class="h3">Latest</h2>
        <p class="muted">Enable JavaScript to browse the full visuals gallery.</p>
      </section>
    </noscript>
  </main>

  <footer class="site-footer">
    <div class="wrap">
      <div class="muted">Â© <span id="yy"></span> StevenAiDigest</div>
    </div>
  </footer>

  <script>
    document.getElementById('yy').textContent = new Date().getFullYear();

    async function loadEditions(){
      try {
        const res = await fetch('/editions/index.json', { cache: 'no-store' });
        if (!res.ok) throw new Error('index fetch failed');
        const data = await res.json();
        return Array.isArray(data) ? data : (data.editions || []);
      } catch (e) {
        return [];
      }
    }

    const grid = document.getElementById('grid');
    const q = document.getElementById('q');
    const y = document.getElementById('y');
    let editions = [];

    function uniqYears(list){
      const set = new Set(list.map(e => e.year).filter(Boolean));
      return Array.from(set).sort().reverse();
    }

    function norm(s){ return (s || '').toString().toLowerCase(); }

    function matches(ed){
      const yy = y.value;
      if (yy !== 'all' && ed.year !== yy) return false;

      const needle = norm(q.value).trim();
      if (!needle) return true;

      const hay = [ed.date, ed.title, ed.summary, ...(ed.tags || [])].map(norm).join(' | ');
      return hay.includes(needle);
    }

    function esc(s){
      return (s || '').toString().replace(/[&<>\"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','\"':'&quot;','\'':'&#39;'}[c]));
    }

    function render(){
      const list = editions.filter(matches);
      if (!list.length){
        grid.innerHTML = `<div class="card"><h2 class="h3">No matches</h2><p class="muted">Try a different search or year filter.</p></div>`;
        return;
      }

      grid.innerHTML = list.map(ed => {
        const thumb = ed.thumbnail || '/assets/visuals/web/editorial-square.webp';
        const tags = (ed.tags || []).slice(0, 6);
        return `
          <a class="tile" href="${esc(ed.url)}" aria-label="Open ${esc(ed.title || ed.date)}">
            <img class="thumb" src="${esc(thumb)}" alt="${esc(ed.title || ed.date)} thumbnail" loading="lazy" />
            <div class="info">
              <div class="k">${esc(ed.date || '')}</div>
              <div class="t">${esc(ed.title || ('Edition ' + (ed.date || '')))}</div>
              ${ed.summary ? `<div class="s">${esc(ed.summary)}</div>` : ''}
              ${tags.length ? `<div class="tags">${tags.map(t => `<span class="tagpill">${esc(t)}</span>`).join('')}</div>` : ''}
            </div>
          </a>
        `;
      }).join('');
    }

    (async function init(){
      editions = await loadEditions();

      // year options
      const ys = uniqYears(editions);
      for (const yy of ys){
        const opt = document.createElement('option');
        opt.value = yy; opt.textContent = yy;
        y.appendChild(opt);
      }

      q.addEventListener('input', render);
      y.addEventListener('change', render);
      render();
    })();
  </script>
</body>
</html>
