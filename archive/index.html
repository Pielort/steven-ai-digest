<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Archive | StevenAiDigest</title>
  <meta name="description" content="Archive of StevenAiDigest editions." />
  <link rel="alternate" type="application/rss+xml" title="StevenAiDigest" href="/feed.xml" />
  <link rel="stylesheet" href="/styles.css" />
</head>
<body>
  <header class="site-header">
    <div class="wrap">
      <a class="brand" href="/">StevenAiDigest</a>
      <nav class="nav">
        <a href="/archive/">Archive</a>
      </nav>
    </div>
  </header>

  <main class="wrap prose">
    <h1>Archive</h1>
    <p class="muted">Permanent links by date. Built for citation and sharing.</p>

    <div class="archive-tools" aria-label="Archive tools">
      <input id="q" class="search" type="search" placeholder="Search editions (e.g. OpenAI, NVIDIA, quantization)" />
      <select id="y" class="select" aria-label="Year">
        <option value="all" selected>All years</option>
      </select>
    </div>

    <section class="grid" id="grid" aria-label="Edition list"></section>

    <noscript>
      <section class="card">
        <h2 class="h3">2026</h2>
        <ul class="list">
          <li><a href="/editions/2026-02-04/">2026-02-04</a> <span class="muted">Four items · operators memo</span></li>
        </ul>
      </section>
    </noscript>
  </main>

  <footer class="site-footer">
    <div class="wrap">
      <div class="muted">© <span id="yy"></span> StevenAiDigest</div>
    </div>
  </footer>

  <script>
    document.getElementById('yy').textContent = new Date().getFullYear();

    async function loadEditions(){
      try {
        const res = await fetch('/editions/index.json', { cache: 'no-store' });
        if (!res.ok) throw new Error('index fetch failed');
        const data = await res.json();
        return Array.isArray(data) ? data : (data.editions || []);
      } catch (e) {
        return [
          {
            date: '2026-02-04',
            year: '2026',
            title: 'Edition 2026-02-04',
            url: '/editions/2026-02-04/',
            summary: 'OpenAI trust artifacts, NVIDIA Rubin, NVFP4 operator recipe, recursive long prompt.',
            tags: ['OpenAI','NVIDIA','inference','security','RAG']
          }
        ];
      }
    }

    const grid = document.getElementById('grid');
    const q = document.getElementById('q');
    const y = document.getElementById('y');

    let editions = [];

    function render(){
      const query = (q.value || '').trim().toLowerCase();
      const year = y.value;
      const rows = editions
        .filter(e => year === 'all' || e.year === year)
        .filter(e => {
          if (!query) return true;
          const hay = [e.date, e.title, e.summary, (e.tags||[]).join(' ')].join(' ').toLowerCase();
          return hay.includes(query);
        })
        .sort((a,b) => (a.date < b.date ? 1 : -1));

      grid.innerHTML = rows.map(e => {
        const hasThumbnail = e.thumbnail;
        const thumbnailUrl = e.thumbnail || '/assets/visuals/web/chart-slide.webp';
        const tags = e.tags || [];
        
        return `
        <a class="tile ${hasThumbnail ? 'has-thumbnail' : ''}" href="${e.url}">
          <div class="tile-content">
            <div class="k">${e.date}</div>
            <div class="t">${e.title}</div>
            <div class="m">${e.summary}</div>
            ${tags.length > 0 ? `
            <div class="tags">
              ${tags.slice(0, 3).map(tag => `<span class="tag-pill">${tag}</span>`).join('')}
              ${tags.length > 3 ? `<span class="tag-pill">+${tags.length - 3}</span>` : ''}
            </div>
            ` : ''}
          </div>
          ${hasThumbnail ? `<img class="thumbnail" src="${thumbnailUrl}" alt="${e.title}" loading="lazy" />` : ''}
        </a>
      `}).join('') || `<div class="muted">No matches.</div>`;
    }

    q.addEventListener('input', render);
    y.addEventListener('change', render);

    (async () => {
      editions = await loadEditions();
      // hydrate year dropdown
      const years = Array.from(new Set(editions.map(e => e.year))).sort().reverse();
      if (years.length) {
        y.innerHTML = '<option value="all">All years</option>' + years.map(yy => `<option value="${yy}">${yy}</option>`).join('');
        y.value = 'all';
      }
      render();
    })();
  </script>
</body>
</html>
